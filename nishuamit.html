<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DSSSB Super Admin ‚ö°</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root { --primary: #4f46e5; --dark: #0f172a; --light: #f1f5f9; --success: #10b981; --danger: #ef4444; --card: #ffffff; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { display: flex; height: 100vh; background: var(--light); color: var(--dark); overflow: hidden; }
    
    /* SIDEBAR */
    .sidebar { width: 260px; background: var(--dark); color: white; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
    .brand { font-size: 22px; font-weight: 800; margin-bottom: 30px; color: var(--primary); display: flex; align-items: center; gap: 10px; letter-spacing: 0.5px; }
    .brand span { color: white; }
    .menu-item { padding: 14px 15px; margin-bottom: 5px; border-radius: 12px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 12px; opacity: 0.7; font-size: 14px; font-weight: 500; }
    .menu-item:hover, .menu-item.active { background: var(--primary); color: white; opacity: 1; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4); }
    
    /* MAIN CONTENT */
    .main { flex: 1; padding: 30px; overflow-y: auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    h2 { font-weight: 800; color: var(--dark); }
    
    /* CARDS */
    .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
    .card { background: var(--card); padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); border: 1px solid #e2e8f0; }
    .stat-val { font-size: 32px; font-weight: 800; margin-top: 5px; color: var(--primary); }
    .stat-lbl { font-size: 12px; color: #64748b; font-weight: 700; text-transform: uppercase; }

    /* FORMS & TABLES */
    .form-box { background: var(--card); padding: 25px; border-radius: 16px; margin-bottom: 25px; border: 1px solid #e2e8f0; }
    .form-title { font-size: 16px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; outline: none; background: #f8fafc; }
    button { padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; }
    
    .table-box { background: var(--card); border-radius: 16px; border: 1px solid #e2e8f0; overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 15px 20px; text-align: left; border-bottom: 1px solid #e2e8f0; font-size: 14px; }
    th { background: #f8fafc; font-weight: 700; color: #64748b; font-size: 12px; text-transform: uppercase; }
    
    /* UTILS */
    .btn-del { background: #fee2e2; color: #ef4444; padding: 6px 12px; border-radius: 6px; font-size: 12px; }
    .btn-apr { background: #dcfce7; color: #16a34a; padding: 6px 12px; border-radius: 6px; font-size: 12px; margin-right: 5px; }
    .section { display: none; animation: fadeIn 0.3s; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* AUTH */
    #authScreen { position: fixed; inset: 0; background: var(--dark); z-index: 1000; display: flex; justify-content: center; align-items: center; }
    .login-box { background: white; padding: 40px; border-radius: 20px; width: 350px; text-align: center; }
</style>
</head>
<body>

<div id="authScreen">
    <div class="login-box">
        <h2 style="margin-bottom:10px;">üîí Admin Access</h2>
        <input type="password" id="adminPin" placeholder="Enter PIN (1234)" style="width: 100%; margin-bottom: 15px; text-align: center; letter-spacing: 5px; font-size: 20px;">
        <button onclick="checkPin()" style="width: 100%;">UNLOCK</button>
    </div>
</div>

<div class="sidebar">
    <div class="brand"><i class="fas fa-bolt"></i> <span>DSSSB Admin</span></div>
    <div class="menu-item active" onclick="showSec('dashboard', this)"><i class="fas fa-chart-pie"></i> Overview</div>
    <div class="menu-item" onclick="showSec('payments', this)"><i class="fas fa-rupee-sign"></i> Payments</div>
    <div class="menu-item" onclick="showSec('content', this)"><i class="fas fa-layer-group"></i> Manage Content</div>
    <div class="menu-item" onclick="showSec('engagement', this)"><i class="fas fa-fire"></i> Broadcast & QOD</div>
    <div class="menu-item" onclick="showSec('users', this)"><i class="fas fa-users"></i> Users & Reports</div>
    <div class="menu-item" onclick="showSec('settings', this)"><i class="fas fa-cogs"></i> App Settings</div>
</div>

<div class="main">
    
    <div id="dashboard" class="section active">
        <div class="header"><h2>üìä Dashboard Overview</h2> <button onclick="location.reload()"><i class="fas fa-sync"></i></button></div>
        <div class="stats-grid">
            <div class="card"><div class="stat-lbl">Total Users</div><div class="stat-val" id="statUsers">0</div></div>
            <div class="card"><div class="stat-lbl">Tests Live</div><div class="stat-val" id="statTests">0</div></div>
            <div class="card"><div class="stat-lbl">Pending Payments</div><div class="stat-val" id="statPay" style="color:#f59e0b;">0</div></div>
            <div class="card"><div class="stat-lbl">Issues</div><div class="stat-val" id="statIssues" style="color:#ef4444;">0</div></div>
        </div>
        <div class="table-box">
            <table><thead><tr><th>Recent Activity</th><th>Details</th><th>Time</th></tr></thead><tbody id="recentTable"></tbody></table>
        </div>
    </div>

    <div id="payments" class="section">
        <div class="header"><h2>üí∏ Payment Approvals</h2></div>
        <div class="table-box">
            <table><thead><tr><th>Student</th><th>UTR / Ref ID</th><th>Action</th></tr></thead><tbody id="payTable"></tbody></table>
        </div>
    </div>

    <div id="content" class="section">
        <div class="header"><h2>üìö Content Manager</h2></div>
        
        <div class="form-box">
            <div class="form-title" style="color:var(--primary);">‚ûï Add New Test</div>
            <div class="grid-2">
                <input type="text" id="tTitle" placeholder="Test Title">
                <input type="text" id="tID" placeholder="Unique ID">
                <input type="text" id="tUrl" placeholder="Link">
                <select id="tCat"><option>Full Mock</option><option>Maths</option><option>Reasoning</option><option>English</option><option>Hindi</option><option>GK</option></select>
                <input type="number" id="tTime" placeholder="Mins"><input type="number" id="tQs" placeholder="Questions">
            </div>
            <button onclick="addTest()">Upload Test</button>
        </div>

        <div class="grid-2">
            <div class="form-box" style="margin-bottom:0;">
                <div class="form-title" style="color:#f59e0b;">üé• Add Video</div>
                <input type="text" id="vTitle" placeholder="Title" style="margin-bottom:10px;">
                <input type="text" id="vUrl" placeholder="YouTube Link" style="margin-bottom:10px;">
                <input type="text" id="vThumb" placeholder="Thumb URL (Optional)" style="margin-bottom:10px;">
                <button onclick="addVideo()" style="background:#f59e0b; width:100%;">Add Video</button>
            </div>
            <div class="form-box" style="margin-bottom:0;">
                <div class="form-title" style="color:#10b981;">üìÑ Add Note</div>
                <input type="text" id="nTitle" placeholder="Title" style="margin-bottom:10px;">
                <input type="text" id="nUrl" placeholder="PDF Link" style="margin-bottom:10px;">
                <button onclick="addNote()" style="background:#10b981; width:100%;">Add Note</button>
            </div>
        </div>
        
        <h3 style="margin-top:20px;">Manage All Items</h3>
        <p style="font-size: 12px; color: grey; margin-bottom: 10px;">Yahan se aap apne Tests, Videos aur Notes ko delete kar sakte hain.</p>
        <div class="table-box">
            <table><thead><tr><th>Type</th><th>Title</th><th>Action</th></tr></thead><tbody id="contentTable"></tbody></table>
        </div>
    </div>

    <div id="engagement" class="section">
        <div class="header"><h2>üî• Engagement Tools</h2></div>

        <div class="form-box" style="border:2px solid #ef4444;">
            <div class="form-title" style="color:#ef4444;">üì¢ Send Pop-up Alert</div>
            <input type="text" id="alertMsg" placeholder="Message (e.g. Result Announced!)" style="margin-bottom:10px;">
            <button onclick="sendAlert()" style="background:#ef4444;">Send Alert</button>
        </div>

        <div class="grid-2">
            <div class="form-box" style="border:2px solid #f97316;">
                <div class="form-title" style="color:#f97316;">üí° Question of the Day</div>
                <textarea id="qodQ" placeholder="Question..." style="height:50px; margin-bottom:10px;"></textarea>
                <div class="grid-2" style="margin-bottom:0;"><input type="text" id="qodO1" placeholder="Op1"><input type="text" id="qodO2" placeholder="Op2"></div>
                <div class="grid-2"><input type="text" id="qodO3" placeholder="Op3"><input type="text" id="qodO4" placeholder="Op4"></div>
                <select id="qodAns" style="margin-bottom:10px;"><option value="0">Ans: 1</option><option value="1">Ans: 2</option><option value="2">Ans: 3</option><option value="3">Ans: 4</option></select>
                <button onclick="updateQOD()" style="background:#f97316; width:100%;">Update</button>
            </div>
            <div class="form-box">
                <div class="form-title">üì∞ Update News Ticker</div>
                <input type="text" id="newsInput" placeholder="Announcement text..." style="margin-bottom:10px;">
                <button onclick="updateNews()" style="width:100%;">Update News</button>
            </div>
        </div>
    </div>

    <div id="users" class="section">
        <div class="header"><h2>üë• Users & Reports</h2></div>
        
        <div class="form-box" style="background:#fffbeb; border-color:#fbbf24;">
            <div class="form-title" style="color:#d97706;">üëë Manual Pro Unlock</div>
            <div class="input-group">
                <input type="text" id="proInput" placeholder="User ID or Username">
                <button onclick="addPro()" style="background:#d97706;">Unlock</button>
            </div>
        </div>

        <h3>üö© Student Issues</h3>
        <div class="table-box">
            <table><thead><tr><th>User</th><th>Issue</th><th>Action</th></tr></thead><tbody id="reportTable"></tbody></table>
        </div>

        <h3 style="margin-top:20px;">All Users</h3>
        <div class="table-box">
            <table><thead><tr><th>User</th><th>ID</th><th>Tests</th><th>Action</th></tr></thead><tbody id="userTable"></tbody></table>
        </div>
    </div>

    <div id="settings" class="section">
        <div class="header"><h2>‚öôÔ∏è App Control Center</h2></div>
        <div class="grid-2">
            <div class="form-box" style="border:2px solid #6366f1;">
                <div class="form-title">üîí Maintenance Mode</div>
                <p style="color:grey; font-size:13px; margin-bottom:10px;">Lock app for all users.</p>
                <button onclick="toggleMaintenance(true)" style="background:#ef4444; margin-right:10px;">Lock App</button>
                <button onclick="toggleMaintenance(false)" style="background:#10b981;">Unlock App</button>
            </div>
            <div class="form-box" style="border:2px solid #ec4899;">
                <div class="form-title">üèÜ Leaderboard</div>
                <p style="color:grey; font-size:13px; margin-bottom:10px;">Clear scores for new week.</p>
                <button onclick="resetLeaderboard()" style="background:#ec4899;">Reset Scores</button>
            </div>
        </div>
    </div>

</div>

<script>
/* FIREBASE CONFIG */
const firebaseConfig = { apiKey: "AIzaSyDGolcXv0efZxRdOvBthfeT72mkNLLbAwI", authDomain: "dsssbexamportal.firebaseapp.com", databaseURL: "https://dsssbexamportal-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "dsssbexamportal", storageBucket: "dsssbexamportal.firebasestorage.app", messagingSenderId: "853373171134", appId: "1:853373171134:web:77b967374e6f34311af5ef" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Global Cache for our content table
let contentCache = { tests: {}, videos: {}, notes: {} };

function checkPin() { if(document.getElementById('adminPin').value === "1234") { document.getElementById('authScreen').style.display = 'none'; loadData(); } else alert("Wrong PIN!"); }
function showSec(id, el) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active')); el.classList.add('active'); }

function loadData() {
    // 1. Users
    db.ref('users').on('value', snap => {
        document.getElementById('statUsers').innerText = snap.numChildren();
        const tbody = document.getElementById('userTable'); tbody.innerHTML = '';
        Object.entries(snap.val()||{}).forEach(([k,u]) => tbody.innerHTML += `<tr><td>${u.name}</td><td>${k}</td><td>${u.testsGiven||0}</td><td><button class="btn-del" onclick="delUser('${k}')">Block</button></td></tr>`);
    });

    // 2. Payments
    db.ref('dsssb_payment_requests').on('value', snap => {
        document.getElementById('statPay').innerText = snap.numChildren();
        const tbody = document.getElementById('payTable'); tbody.innerHTML = '';
        Object.entries(snap.val()||{}).forEach(([k,r]) => {
            tbody.innerHTML += `<tr><td>${r.name}<br><small>${r.userId}</small></td><td style="color:blue;">${r.utr}</td><td><button class="btn-apr" onclick="approve('${k}','${r.userId}')">Approve</button><button class="btn-del" onclick="reject('${k}')">Reject</button></td></tr>`;
        });
    });

    // 3. Reports
    db.ref('dsssb_reports').on('value', s => {
        document.getElementById('statIssues').innerText = s.numChildren();
        const tbody = document.getElementById('reportTable'); tbody.innerHTML = '';
        Object.entries(s.val()||{}).forEach(([k,r]) => tbody.innerHTML += `<tr><td>${r.user}</td><td>${r.issue}</td><td><button class="btn-del" onclick="resolve('${k}')">Resolve</button></td></tr>`);
    });

    // 4. Content Manager (Tests, Videos, Notes)
    db.ref('dsssb_tests_db').on('value', s => {
        document.getElementById('statTests').innerText = s.numChildren();
        contentCache.tests = s.val() || {};
        renderContentTable();
    });
    
    db.ref('dsssb_videos_db').on('value', s => {
        contentCache.videos = s.val() || {};
        renderContentTable();
    });
    
    db.ref('dsssb_notes_db').on('value', s => {
        contentCache.notes = s.val() || {};
        renderContentTable();
    });
    
    // 5. Activity
    db.ref('dsssb_results_live').limitToLast(10).on('value', s => {
        const tbody = document.getElementById('recentTable'); tbody.innerHTML = '';
        Object.values(s.val()||{}).reverse().forEach(r => tbody.innerHTML += `<tr><td><b>${r.name}</b></td><td>Scored ${r.score} in ${r.testId}</td><td>Just now</td></tr>`);
    });
}

// Ye function Teeno (Tests, Videos, Notes) ko ek table mein dikhayega!
function renderContentTable() {
    const tbody = document.getElementById('contentTable'); 
    let html = '';
    
    // 1. Render Tests
    Object.entries(contentCache.tests).reverse().forEach(([k,v]) => {
        html += `<tr><td><span style="background:#e0e7ff; color:#4f46e5; padding:3px 8px; border-radius:4px; font-size:11px; font-weight:bold;">Test</span></td><td>${v.title}</td><td><button class="btn-del" onclick="delItem('dsssb_tests_db/${k}')">Delete</button></td></tr>`;
    });
    
    // 2. Render Videos
    Object.entries(contentCache.videos).reverse().forEach(([k,v]) => {
        html += `<tr><td><span style="background:#fef3c7; color:#d97706; padding:3px 8px; border-radius:4px; font-size:11px; font-weight:bold;">Video</span></td><td>${v.title}</td><td><button class="btn-del" onclick="delItem('dsssb_videos_db/${k}')">Delete</button></td></tr>`;
    });
    
    // 3. Render Notes
    Object.entries(contentCache.notes).reverse().forEach(([k,v]) => {
        html += `<tr><td><span style="background:#d1fae5; color:#059669; padding:3px 8px; border-radius:4px; font-size:11px; font-weight:bold;">Note</span></td><td>${v.title}</td><td><button class="btn-del" onclick="delItem('dsssb_notes_db/${k}')">Delete</button></td></tr>`;
    });
    
    tbody.innerHTML = html;
}

/* ACTIONS */
function approve(key, uid) { if(confirm("Approve?")) { db.ref('dsssb_pro_users').push(uid.toString().toLowerCase().trim().replace("@","")); db.ref('dsssb_payment_requests/'+key).remove(); } }
function reject(key) { if(confirm("Reject?")) db.ref('dsssb_payment_requests/'+key).remove(); }

function addTest() { const d = { title: document.getElementById('tTitle').value, id: document.getElementById('tID').value, url: document.getElementById('tUrl').value, time: document.getElementById('tTime').value, qs: document.getElementById('tQs').value, category: document.getElementById('tCat').value, type:'free' }; if(d.title) db.ref('dsssb_tests_db').push(d).then(() => alert("Test Added!")); }
function addVideo() { const url = document.getElementById('vUrl').value; const vidId = url.split('v=')[1]?.split('&')[0] || url.split('/').pop(); const d = { title: document.getElementById('vTitle').value, url: url, thumb: document.getElementById('vThumb').value || `https://img.youtube.com/vi/${vidId}/mqdefault.jpg` }; if(d.title) db.ref('dsssb_videos_db').push(d).then(() => alert("Video Added!")); }
function addNote() { const d = { title: document.getElementById('nTitle').value, url: document.getElementById('nUrl').value }; if(d.title) db.ref('dsssb_notes_db').push(d).then(() => alert("Note Added!")); }

function updateQOD() { const d = { q: document.getElementById('qodQ').value, opt: [document.getElementById('qodO1').value, document.getElementById('qodO2').value, document.getElementById('qodO3').value, document.getElementById('qodO4').value], ans: parseInt(document.getElementById('qodAns').value) }; if(d.q) db.ref('dsssb_config/qod').set(d).then(() => alert("QOD Updated!")); }
function updateNews() { const txt = document.getElementById('newsInput').value; if(txt) db.ref('dsssb_config/news').set(txt).then(() => alert("News Updated!")); }
function sendAlert() { const msg = document.getElementById('alertMsg').value; if(msg) db.ref('dsssb_config/alert').set({ msg: msg, time: Date.now() }).then(() => alert("Alert Sent!")); }

function toggleMaintenance(s) { db.ref('dsssb_config/maintenance').set(s).then(() => alert("Mode: " + (s ? "LOCKED" : "UNLOCKED"))); }
function resetLeaderboard() { if(confirm("Reset scores?")) db.ref('dsssb_results_live').remove().then(() => alert("Done!")); }
function addPro() { const v = document.getElementById('proInput').value.trim().toLowerCase(); if(v) db.ref('dsssb_pro_users').push(v).then(() => alert("Pro Added!")); }

function delUser(k) { if(confirm("Block User?")) db.ref('users/'+k).remove(); }
function delItem(p) { if(confirm("Are you sure you want to delete this?")) db.ref(p).remove(); }
function resolve(k) { db.ref('dsssb_reports/'+k).remove(); }
</script>
</body>
</html>
